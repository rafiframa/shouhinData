<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è£½å“ä¿è¨¼æ›¸ PDF ç”Ÿæˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Noto Sans JP', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            min-width: 180px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .preview {
            background: #f8f9fa;
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
            text-align: center;
            color: #666;
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .info-box {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #1565c0;
        }
        
        .warning-box {
            background: #fff3e0;
            border: 1px solid #ff9800;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #e65100;
        }

        /* Hidden warranty template for PDF generation */
        .warranty-template {
            position: absolute;
            left: -9999px;
            width: 210mm;
            min-height: 297mm;
            background: white;
            padding: 20mm;
            font-family: 'MS Gothic', 'Yu Gothic', 'Hiragino Sans', sans-serif;
            font-size: 12pt;
            line-height: 1.6;
            color: black;
        }

        .warranty-template h1 {
            text-align: center;
            font-size: 24pt;
            margin-bottom: 20px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }

        .warranty-template .section {
            margin-bottom: 20px;
        }

        .warranty-template .section-title {
            font-size: 16pt;
            font-weight: bold;
            border-bottom: 1px solid #666;
            margin-bottom: 10px;
            padding-bottom: 5px;
        }

        .warranty-template .field {
            margin-bottom: 8px;
            padding-left: 10px;
        }

        .warranty-template .terms {
            font-size: 10pt;
            background: #f9f9f9;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .warranty-template .issuer {
            text-align: right;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ccc;
        }

        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .error-message {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“‹ è£½å“ä¿è¨¼æ›¸ PDF ç”Ÿæˆå™¨</h1>
        
        <div class="info-box">
            <strong>ğŸ’¡ æ—¥æœ¬èªPDFç”Ÿæˆã«ã¤ã„ã¦</strong><br>
            HTML2Canvas + jsPDF ã‚’ä½¿ç”¨ã—ã¦æ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆã‚’æ­£ã—ãè¡¨ç¤ºã™ã‚‹PDFã‚’ç”Ÿæˆã—ã¾ã™ã€‚
        </div>
        
        <form id="warrantyForm">
            <div class="form-group">
                <label for="productName">è£½å“å:</label>
                <input type="text" id="productName" value="ãƒ‡ã‚¸ã‚¿ãƒ«ã‚«ãƒ¡ãƒ© XZ-1000" required>
            </div>
            
            <div class="form-group">
                <label for="modelNumber">å‹ç•ª:</label>
                <input type="text" id="modelNumber" value="XZ-1000-BK" required>
            </div>
            
            <div class="form-group">
                <label for="serialNumber">ã‚·ãƒªã‚¢ãƒ«ç•ªå·:</label>
                <input type="text" id="serialNumber" value="JP2024001234" required>
            </div>
            
            <div class="form-group">
                <label for="customerName">ãŠå®¢æ§˜æ°å:</label>
                <input type="text" id="customerName" value="ç”°ä¸­ å¤ªéƒ" required>
            </div>
            
            <div class="form-group">
                <label for="customerAddress">ã”ä½æ‰€:</label>
                <textarea id="customerAddress" required>ã€’100-0001
æ±äº¬éƒ½åƒä»£ç”°åŒºåƒä»£ç”°1-1-1
åƒä»£ç”°ãƒãƒ³ã‚·ãƒ§ãƒ³101å·å®¤</textarea>
            </div>
            
            <div class="form-group">
                <label for="phoneNumber">é›»è©±ç•ªå·:</label>
                <input type="tel" id="phoneNumber" value="03-1234-5678" required>
            </div>
            
            <div class="form-group">
                <label for="purchaseDate">è³¼å…¥æ—¥:</label>
                <input type="date" id="purchaseDate" value="2024-05-15" required>
            </div>
            
            <div class="form-group">
                <label for="purchaseStore">è³¼å…¥åº—èˆ—:</label>
                <input type="text" id="purchaseStore" value="é›»å™¨å±‹ã•ã‚“ æ–°å®¿åº—" required>
            </div>
            
            <div class="form-group">
                <label for="warrantyPeriod">ä¿è¨¼æœŸé–“:</label>
                <select id="warrantyPeriod" required>
                    <option value="1å¹´">1å¹´</option>
                    <option value="2å¹´">2å¹´</option>
                    <option value="3å¹´" selected>3å¹´</option>
                    <option value="5å¹´">5å¹´</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="companyName">ä¼šç¤¾å:</label>
                <input type="text" id="companyName" value="æ ªå¼ä¼šç¤¾ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼" required>
            </div>
            
            <div class="button-group">
                <button type="button" onclick="generateJapanesePDF()">ğŸ“„ PDFç”Ÿæˆ</button>
                <button type="button" onclick="previewWarranty()">ğŸ‘ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º</button>
            </div>
        </form>
        
        <div class="preview" id="previewArea">
            <p>ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›å¾Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è£½å“ä¿è¨¼æ›¸ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚</p>
        </div>
    </div>

    <!-- Hidden warranty template -->
    <div class="warranty-template" id="warrantyTemplate">
        <h1>è£½å“ä¿è¨¼æ›¸</h1>
        
        <div class="section">
            <div class="section-title">è£½å“æƒ…å ±</div>
            <div class="field">è£½å“å: <span id="template-productName"></span></div>
            <div class="field">å‹ç•ª: <span id="template-modelNumber"></span></div>
            <div class="field">ã‚·ãƒªã‚¢ãƒ«ç•ªå·: <span id="template-serialNumber"></span></div>
        </div>
        
        <div class="section">
            <div class="section-title">ãŠå®¢æ§˜æƒ…å ±</div>
            <div class="field">ãŠå®¢æ§˜æ°å: <span id="template-customerName"></span></div>
            <div class="field">ã”ä½æ‰€: <pre id="template-customerAddress" style="font-family: inherit; margin: 0; white-space: pre-wrap;"></pre></div>
            <div class="field">é›»è©±ç•ªå·: <span id="template-phoneNumber"></span></div>
        </div>
        
        <div class="section">
            <div class="section-title">ä¿è¨¼æƒ…å ±</div>
            <div class="field">è³¼å…¥æ—¥: <span id="template-purchaseDate"></span></div>
            <div class="field">è³¼å…¥åº—èˆ—: <span id="template-purchaseStore"></span></div>
            <div class="field">ä¿è¨¼æœŸé–“: <span id="template-warrantyPeriod"></span></div>
            <div class="field">ä¿è¨¼çµ‚äº†æ—¥: <span id="template-warrantyEndDate"></span></div>
        </div>
        
        <div class="section">
            <div class="section-title">ä¿è¨¼è¦å®š</div>
            <div class="terms">
                <div>1. æœ¬ä¿è¨¼æ›¸ã¯ã€è¨˜è¼‰ã•ã‚ŒãŸæœŸé–“å†…ã«ãŠã‘ã‚‹ç„¡å„Ÿä¿®ç†ã‚’ãŠç´„æŸã™ã‚‹ã‚‚ã®ã§ã™ã€‚</div>
                <div>2. ä¿è¨¼æœŸé–“å†…ã§ã‚‚ã€ãŠå®¢æ§˜ã®æ•…æ„ãƒ»éå¤±ã«ã‚ˆã‚‹æ•…éšœã¯æœ‰å„Ÿä¿®ç†ã¨ãªã‚Šã¾ã™ã€‚</div>
                <div>3. æœ¬ä¿è¨¼æ›¸ã¯å†ç™ºè¡Œã„ãŸã—ã¾ã›ã‚“ã®ã§ã€å¤§åˆ‡ã«ä¿ç®¡ã—ã¦ãã ã•ã„ã€‚</div>
                <div>4. ä¿è¨¼ä¿®ç†ã‚’å—ã‘ã‚‹éš›ã¯ã€å¿…ãšæœ¬ä¿è¨¼æ›¸ã‚’ã”æŒå‚ãã ã•ã„ã€‚</div>
                <div>5. æœ¬ä¿è¨¼æ›¸ã¯æ—¥æœ¬å›½å†…ã§ã®ã¿æœ‰åŠ¹ã§ã™ã€‚</div>
            </div>
        </div>
        
        <div class="issuer">
            <div>ç™ºè¡Œè€…: <span id="template-companyName"></span></div>
            <div>ç™ºè¡Œæ—¥: <span id="template-issueDate"></span></div>
        </div>
    </div>

    <script>
        function getFormData() {
            return {
                productName: document.getElementById('productName').value,
                modelNumber: document.getElementById('modelNumber').value,
                serialNumber: document.getElementById('serialNumber').value,
                customerName: document.getElementById('customerName').value,
                customerAddress: document.getElementById('customerAddress').value,
                phoneNumber: document.getElementById('phoneNumber').value,
                purchaseDate: document.getElementById('purchaseDate').value,
                purchaseStore: document.getElementById('purchaseStore').value,
                warrantyPeriod: document.getElementById('warrantyPeriod').value,
                companyName: document.getElementById('companyName').value
            };
        }
        
        function getFormattedDates(formData) {
            const purchaseDate = new Date(formData.purchaseDate);
            const formattedDate = `${purchaseDate.getFullYear()}å¹´${purchaseDate.getMonth() + 1}æœˆ${purchaseDate.getDate()}æ—¥`;
            
            const warrantyYears = parseInt(formData.warrantyPeriod.replace('å¹´', ''));
            const endDate = new Date(purchaseDate);
            endDate.setFullYear(endDate.getFullYear() + warrantyYears);
            const formattedEndDate = `${endDate.getFullYear()}å¹´${endDate.getMonth() + 1}æœˆ${endDate.getDate()}æ—¥`;
            
            return { formattedDate, formattedEndDate };
        }

        function updateTemplate() {
            const formData = getFormData();
            const { formattedDate, formattedEndDate } = getFormattedDates(formData);
            
            // Update template with form data
            document.getElementById('template-productName').textContent = formData.productName;
            document.getElementById('template-modelNumber').textContent = formData.modelNumber;
            document.getElementById('template-serialNumber').textContent = formData.serialNumber;
            document.getElementById('template-customerName').textContent = formData.customerName;
            document.getElementById('template-customerAddress').textContent = formData.customerAddress;
            document.getElementById('template-phoneNumber').textContent = formData.phoneNumber;
            document.getElementById('template-purchaseDate').textContent = formattedDate;
            document.getElementById('template-purchaseStore').textContent = formData.purchaseStore;
            document.getElementById('template-warrantyPeriod').textContent = formData.warrantyPeriod;
            document.getElementById('template-warrantyEndDate').textContent = formattedEndDate;
            document.getElementById('template-companyName').textContent = formData.companyName;
            
            const today = new Date();
            const todayFormatted = `${today.getFullYear()}å¹´${today.getMonth() + 1}æœˆ${today.getDate()}æ—¥`;
            document.getElementById('template-issueDate').textContent = todayFormatted;
        }

        function previewWarranty() {
            updateTemplate();
            const template = document.getElementById('warrantyTemplate');
            const preview = document.getElementById('previewArea');
            
            // Clone the template and show it in preview
            const clone = template.cloneNode(true);
            clone.style.position = 'static';
            clone.style.left = 'auto';
            clone.style.width = 'auto';
            clone.style.minHeight = 'auto';
            clone.style.border = '1px solid #ddd';
            clone.style.borderRadius = '8px';
            clone.style.padding = '20px';
            clone.style.background = 'white';
            
            preview.innerHTML = '';
            preview.appendChild(clone);
        }
        
        async function generateJapanesePDF() {
            try {
                showMessage('PDFç”Ÿæˆä¸­...', 'info');
                
                updateTemplate();
                const template = document.getElementById('warrantyTemplate');
                
                // Temporarily show the template for html2canvas
                template.style.position = 'fixed';
                template.style.left = '0';
                template.style.top = '0';
                template.style.zIndex = '-1000';
                template.style.opacity = '1';
                
                // Generate canvas from HTML
                const canvas = await html2canvas(template, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    width: template.offsetWidth,
                    height: template.offsetHeight
                });
                
                // Hide the template again
                template.style.position = 'absolute';
                template.style.left = '-9999px';
                template.style.zIndex = 'auto';
                template.style.opacity = '0';
                
                // Create PDF
                const { jsPDF } = window.jspdf;
                const imgData = canvas.toDataURL('image/png');
                
                // Calculate dimensions for A4
                const imgWidth = 210; // A4 width in mm
                const pageHeight = 297; // A4 height in mm
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                const pdf = new jsPDF('p', 'mm', 'a4');
                pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                
                const formData = getFormData();
                const fileName = `è£½å“ä¿è¨¼æ›¸_${formData.serialNumber}.pdf`;
                pdf.save(fileName);
                
                showMessage(`âœ… PDFç”Ÿæˆå®Œäº†: ${fileName}`, 'success');
                
            } catch (error) {
                console.error('PDFç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                showMessage(`âŒ PDFç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
            }
        }
        
        function showMessage(message, type) {
            const preview = document.getElementById('previewArea');
            const messageClass = type === 'success' ? 'success-message' : 
                                type === 'error' ? 'error-message' : 'info-box';
            
            preview.innerHTML = `<div class="${messageClass}">${message}</div>`;
            
            if (type === 'info') {
                setTimeout(() => {
                    preview.innerHTML = '<p>ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›å¾Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è£½å“ä¿è¨¼æ›¸ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚</p>';
                }, 3000);
            }
        }

        // Auto-preview when form changes
        document.getElementById('warrantyForm').addEventListener('input', previewWarranty);
        
        // Initial preview
        window.addEventListener('load', previewWarranty);
    </script>
</body>
</html>